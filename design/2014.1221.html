#!/usr/bin/perl
# 99aeabc9ec7fe80b1b39f5e53dc7e49e      <- self-modifying Perl magic
# state:  ++zgsFjS7rNmdm0sQHVh4VNcbtMVvVbW6kPB4EYjZ+w
# istate: LFWQomYA1er/ReQoYxkDUZpja2rpQ5AGlkKBBIjHAEY
# id:     exjqQpvST1yt4ZdzTErmv+zvqA6h0kMZ+OQSn0RW7ew

# This is a self-modifying Perl file. I'm sorry you're viewing the source (it's
# really gnarly). If you're curious what it's made of, I recommend reading
# http://github.com/spencertipping/writing-self-modifying-perl.
#
# If you got one of these from someone and don't know what to do with it, send
# it to spencer@spencertipping.com and I'll see if I can figure out what it
# does.

# For the benefit of HTML viewers (this is a hack):
# <div id='cover' style='position: absolute; left: 0; top: 0; width: 10000px; height: 10000px; background: white'></div>

$|++;

my %data;
my %transient;
my %externalized_functions;
my %datatypes;

my %locations;          # Maps eval-numbers to attribute names

my $global_data = join '', <DATA>;

sub meta::define_form {
  my ($namespace, $delegate) = @_;
  $datatypes{$namespace} = $delegate;
  *{"meta::${namespace}::implementation"} = $delegate;
  *{"meta::$namespace"} = sub {
    my ($name, $value, %options) = @_;
    chomp $value;
    $data{"${namespace}::$name"} = $value unless $options{no_binding};
    &$delegate($name, $value) unless $options{no_delegate}}}

sub meta::eval_in {
  my ($what, $where) = @_;

  # Obtain next eval-number and alias it to the designated location
  @locations{eval('__FILE__') =~ /\(eval (\d+)\)/} = ($where);

  my $result = eval $what;
  $@ =~ s/\(eval \d+\)/$where/ if $@;
  warn $@ if $@;
  $result}

meta::define_form 'meta', sub {
  my ($name, $value) = @_;
  meta::eval_in($value, "meta::$name")};
eval `/home/spencertipping/r/initiative/perl-objects/notes serialize -p`; die $@ if $@;
eval `object serialize -p`; die $@ if $@;
meta::cache('parent-identification', <<'__');
/home/spencertipping/r/initiative/perl-objects/notes a9e5975593ed5d90d943ad98405c71e5
object 99aeabc9ec7fe80b1b39f5e53dc7e49e
__
meta::cache('parent-state', <<'__');
99aeabc9ec7fe80b1b39f5e53dc7e49e 8o6O4hqEnGDxNC5FgK+q340aKWykAb+LRLAe0Fi9xMc
a9e5975593ed5d90d943ad98405c71e5 21rFW0cbMFtbY56uoN16l/ZlsJxAHKK431eTvQChPI4
__
meta::data('author', 'Spencer Tipping');
meta::data('default-action', 'shell');
meta::data('file-nuke-backend', 'shred');
meta::data('license', <<'__');
MIT License
Copyright (c) 2010 Spencer Tipping

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
__
meta::data('permanent-identity', 'exjqQpvST1yt4ZdzTErmv+zvqA6h0kMZ+OQSn0RW7ew');
meta::data('save-indirect', '1');
meta::data('watching', '1');
meta::hook('before-shell::ad', 'ad(\'note::\');');
meta::hook('before-shell::default-note', 'create(\'note::default\');');
meta::note('default', <<'__');
Integral model.
A program's execution is kind of like a half-definite integral of the
side-effecting function over time ("time" in the abstract sense). Most of the
time interpreters do the equivalent of numerical Riemann integration, but this
misses a lot of the advantage possible by symbolic manipulation.

Likewise, the progression from source code to a parsed representation to a
program to its execution involves its own integral transforms; we should be
able to represent all of these stages using the appropriate free variables.
That way you can specify the layer you want to address; e.g. "do this
transformation against _unparsed_ source code".

__
meta::parent('/home/spencertipping/r/initiative/perl-objects/notes', <<'__');
function::note    b96+lYUBUJIx1rD5Ay9018BBRP5h++6/90bEaOx7+IY
function::notes   zvS1hx63x9gpPdLMcF68585BXdVWdSlqkkssFxqXZU4
meta::type::note  4P8m6fY9qL46kdlhIixbEVXgoGPCbIPKW6THhUtZd/0
parent::object    Q4+42U+xCxGddLIZDnUc031ma2zMh4LJa3dm9v3H8IM
__
internal::main();
__DATA__
